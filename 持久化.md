### æŒä¹…åŒ–æ‰‹æ®µ

- UserDefault
- NSKeyedArchiver 
- JSEncoder
- data.write(to:options:)
- coreData
- Sqlite
- keychain

Demo:

### UserDefault

**ç›®æ ‡**ï¼šè¦æŒä¹…åŒ–çš„å¯¹è±¡åªèƒ½æ˜¯åŸºæœ¬ç±»å‹æˆ–è€…åŸºæœ¬ç±»å‹ä¸ºå…ƒç´ çš„é›†åˆã€‚å¦‚ä¸‹å›¾



![image-20240501203031172](./Image/UserDefault-1.png)





å¦‚æœæ˜¯è‡ªå®šä¹‰ç±»å‹æˆ–è€…è‡ªå®šä¹‰ç±»å‹çš„å…ƒç´ çš„é›†åˆï¼Œæ˜¯ä¸æ”¯æŒçš„ï¼Œä½†<u>å¯ä»¥é€šè¿‡è½¬æ¢ç±»å‹ä¸º `Data` ç±»å‹åï¼Œå†ä¿å­˜</u>ã€‚

**åªé€‚åˆä¿å­˜å°æ•°æ®**:å¯¹äº UserDefault ä¿å­˜çš„å¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯æ”¾åœ¨æ²™ç›’ç›®å½•**AppData->Library->Preferences**ä¸‹çš„ä¸€ä¸ª plist æ–‡ä»¶ã€‚å…¶ä¸­ key å€¼å°±æ˜¯å£°æ˜çš„ key,value å°±æ˜¯ä¿å­˜çš„æ•°æ®ã€‚ç”±äºæ‰€æœ‰ä½¿ç”¨UserDefaultçš„å†…å®¹éƒ½ä¿å­˜åœ¨é‚£é‡Œï¼Œè€Œä¸”è¯»å–å¯¹è±¡çš„æ—¶å€™éœ€è¦è¯»å–æ•´ä¸ª plist æ–‡ä»¶ï¼Œå› æ­¤åªé€‚åˆä¿å­˜å¾ˆå°çš„æ•°æ®

æŒä¹…åŒ–ä¸€ä¸ªè‡ªå®šä¹‰å¯¹è±¡

```swift
func useJSONEncoder() {
    let user: User = User(name: "john", age: 18)
    let encoder: JSONEncoder = JSONEncoder()
    if let data = try? encoder.encode(user) {
        UserDefaults.standard.setValue(data, forKey: "user")
        let decoder: JSONDecoder = JSONDecoder()
        if let user2 = try? decoder.decode(User.self, from: data) {
            print(user2.name)
            print(user2.age)
        }
    }
}
```



### NSKeyedArchiver 

æœ‰ä¸¤ä¸ªä½œç”¨

- ä¸ä½¿ç”¨data.write(to:options:),ç›´æ¥å°†éµä»NSCodingåè®®çš„è‡ªå®šä¹‰å¯¹è±¡å½’æ¡£åˆ°æ–‡ä»¶ ã€iOS12.0 ä»¥ä¸ŠåºŸå¼ƒã€‘
- åªæ˜¯å°†éµä»NSCodingåè®®è‡ªå®šä¹‰å¯¹è±¡è½¬æ¢ä¸º `Data`

#### NSCoding åè®®

ä¸ºäº†ä½¿ç”¨NSKeyedArchiveræŒä¹…åŒ–æˆ–ä»…ä»…å°†å¯¹è±¡è½¬ä¸º Data ç±»å‹ï¼Œå¯¹è±¡éœ€è¦éµä» NSCoding åè®®ï¼Œå¹¶ä¸”å®ç°åè®®ä¸­çš„ä¸¤ä¸ªæ–¹æ³•

```swift
func encode(with coder: NSCoder)

required init?(coder: NSCoder)
```

NSCodingåè®®åªèƒ½ç”±Classæ¥éµä»ï¼Œè€Œä¸èƒ½ç”± Struct éµä»ã€‚è¿™é‡Œå®é™…ä½¿ç”¨çš„æ˜¯NSCodingå­ç±»ã€‚å¦åˆ™è°ƒç”¨å½’æ¡£æ–¹æ³•çš„æ—¶å€™ä¼šæŠ¥é”™

```swift
class Dog: NSObject, NSSecureCoding {
    var name: String = ""
    var age: String = ""
    
    func encode(with coder: NSCoder) {
        // å³NSKeyedArchiverç±»å‹
        coder.encode(name, forKey: "name")
        coder.encode(age, forKey: "age")
    }
    
    
    required init?(coder: NSCoder) {
        if let name = coder.decodeObject(forKey: "name") as? String {
            self.name = name
        }else {
            self.name = ""
        }
        if let age = coder.decodeObject(forKey: "age") as? String {
            self.age = age
        }else {
            self.age = "0"
        }
    }
    
    init(name: String, age: String) {
        self.name = name
        self.age = age
    }
    
    static var supportsSecureCoding: Bool { true }
}
```

#### ç›´æ¥å½’æ¡£åˆ°æ–‡ä»¶

```swift
    func useNSKeyedArchiverCache() {
//      archiveRootObject(_:toFile:)' was deprecated in iOS 12.0
//      let dog: Dog = Dog(name: "tom", age: 3)
//      NSKeyedArchiver.archiveRootObject(dog, toFile: ##)
    }
```

è¿™ä¸ª API å·²ç»åœ¨ iOS12 ä¸‹è¢«åºŸå¼ƒï¼Œä½¿ç”¨çš„æ—¶å€™ä¼šæç¤ºè¦åªä½¿ç”¨å®ƒçš„è½¬æ¢ä¸º Data çš„åŠŸèƒ½ï¼Œå†ä½¿ç”¨`data.write(to:options:)`

```swift
'archiveRootObject(_:toFile:)' was deprecated in iOS 12.0: Use +archivedDataWithRootObject:requiringSecureCoding:error: and -writeToURL:options:error: instead
```

#### è½¬æ¢ä¸º Data

```swift
func useNSKeyedArchiverAndDataCache() {
        let dog: Dog = Dog(name: "tom", age: "3")
        if let data = try? NSKeyedArchiver.archivedData(withRootObject: dog, requiringSecureCoding: true) {
            if let dog = try? NSKeyedUnarchiver.unarchivedObject(ofClass: Dog.self, from: data) {
                print("ğŸ˜„" + "\(dog.age)")
                print("ğŸ˜„" + "\(dog.name)")
            }
        }
    }
```

### JSEncoder



### é€‰å‹

- å¦‚æœæ˜¯å¾ˆå°çš„æ•°æ®ï¼Œä¼˜é€‰UserDefaultï¼Œæ²¡æœ‰å¿…è¦å°†è¿™éƒ¨åˆ†æ•°æ®ä¿å­˜åœ¨ä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶ã€‚å¦‚æœè¿™ä¸ªå¾ˆå°çš„æ•°æ®ä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–è€…åŸºæœ¬æ•°æ®ç±»å‹çš„é›†åˆã€‚ä¼˜å…ˆé€‰æ‹©å¯ä»¥é€šè¿‡JSONEncoderè€Œä¸æ˜¯NSKeyedArchiverè½¬æ¢ä¸º Dataç±»å‹,ç„¶åä½¿ç”¨UserDefaultæ¥ä¿å­˜æ•°æ®

- å¦‚æœæ˜¯æ¯”è¾ƒå¤§çš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨JSONEncoderè½¬æ¢ä¸º Dataç±»å‹ï¼Œç„¶åä½¿ç”¨data.write(to:options:) ä¿å­˜åˆ°æŸä¸ªæ–‡ä»¶

- å¦‚æœæ˜¯å¾ˆæ•æ„Ÿçš„æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·è´¦å·ä¸å¯†ç ä¸”ä¸å¸Œæœ›ç”¨æˆ·åˆ æ‰app åä¸¢å¤±ï¼Œå°†æ•°æ®ä¿å­˜åˆ°é’¥åŒ™ä¸²æ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©ã€‚

- å¦‚æœæ•°æ®éœ€è¦é¢‘ç¹çš„å¢åˆ æ”¹æŸ¥ï¼Œä½¿ç”¨ sqlite æˆ–è€…è‹¹æœå°è£…çš„ coreData æ˜¯æ¯”è¾ƒå¥½çš„é€‰æ‹©

